
{% extends 'BC2_html/index.html' %}
{% load static staticfiles %}
{% block title %}
    商品列表
{% endblock %}

{% block body %}
 <style type="text/css">
.minus{width: 30px; height: 30px; text-align: center;border: solid 1px #eaeaea; background: #f5f5f5; color: #9e9e9e;}
.numbox{border-top: solid 1px #eaeaea; border-bottom: solid 1px #eaeaea; height: 28px; width:60px; color: #333333; margin-left:-8px; text-align: center; background: transparent;}

 </style>
    <link rel="stylesheet" href="{% static 'layui/css/layui.css' %}">
    <script src="{% static 'js/jquery.input-counter.min.js' %}"></script>
    <section id="main">
        <div class="container_12">
            <div id="content" class="grid_12">
                <header>
                    <h1 class="page_title">购物车</h1>
                </header>

                <article>
                    <table class="cart_product layui-table" style="text-align: center;">
                        <tr class="bg" style="text-align: center;">
                            <th class="images" width="100px">商品图片</th>
                            <th class="images">商品名称</th>
                            <th class="price">商品单价</th>
                            <th class="qty">商品数量</th>
                            <th class="subtotal">商品总计</th>
                            <th class="close"> </th>
                        </tr>

                        {% for v,i in data.items %}
                        <tr >
                            <td class="name" ><a href="product_page.html" ><img src=".{{ i.goods.Commodity_img }}" style="width: 100px;margin: auto;"></a></td>

                            <td class="name "  style="width: 50px;"><samp>{{ i.goods.Commodity_name }}</samp></td>
                            <td class="price">${{ i.goods.Price }}</td>
                            <td class="qty" width="200px">
                            <input class="minus min" name="" type="button" value="-" />
                            <input class="text_box" name="" type="text" value="{{ i.num }}" />
                            <input class="minus add" name="" type="button" value="+" />

                            </td>
                            <td class="subtotal">$123.00</td>
                            <td class="close"><a title="close" class="" href="#">删除</a></td>
                        </tr>
                      {% endfor %}

                        <tr>
                            <td colspan="7" class="cart_but">
                                <a href="#" class="continue"><img src="img/cont.png" alt="" title=""> Continue Shopping</a>
                                <a href="#" class="update"><img src="img/update.png" alt="" title=""> Update Shopping Cart</a>
                            </td>
                        </tr>
                    </table>
                    <div id="cart_forms">
                        <div class="grid_4">
                            <br>
                        </div>
                        <div class="grid_4">
                            <br>
                        </div>
                        <div class="grid_4">
                            <div class="bottom_block total">
                                <table class="subtotal">
                                    <tr>
                                        <td>Subtotal</td><td class="price">$1, 500.00</td>
                                    </tr>
                                    <tr class="grand_total">
                                        <td>Grand Total</td><td class="price">$1, 500.00</td>
                                    </tr>
                                </table>
                                <button class="checkout">PROCEED TO CHECKOUT <img src="img/checkout.png" alt="" title=""></button>
                                <a href="#">Checkout with Multiple Addresses</a>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="clear"></div>
		</article>
                <div class="clear"></div>
            </div>
            <div class="clear"></div>
        </div>
    </section>
    <div class="clear"></div>


<script>
window.onload = function(){
	var oP = document.getElementsByTagName('p')[0];
	var	aEm = oP.getElementsByTagName('em');
	var	aStrong = oP.getElementsByTagName('strong')[0];
	var oUl = document.getElementById('list');
	var oLi = oUl.getElementsByTagName('li');
	var oStrong = oUl.getElementsByTagName('strong');
	for(var i=0;i<oLi.length;i++){
        fn1(oLi[i]);
	}

	function fn1(aLi){
		var oBtn = aLi.getElementsByTagName('input');
	    var	oStrong = aLi.getElementsByTagName('strong')[0];
		var	oEm = aLi.getElementsByTagName('em')[0];
		var	oSpan = aLi.getElementsByTagName('span')[0];
		var n1 = Number(oStrong.innerHTML);
		var n2 = parseFloat(oEm.innerHTML);
		//合计总价，必然要相加所有的小计
       function fn2(){
          var sum1=0;//定义一个临时变量，用来储存所加过的件数
          var sum2=0;//定义一个临时变量，用来储存所加过的小计
          var emMax=0;//定义一个临时变量，用来比较单价的大小
          for(var i=0;i<oLi.length;i++){
	     var strongs=oLi[i].getElementsByTagName("strong")[0];//获取到所有li的数量
             var spans=oLi[i].getElementsByTagName("span")[0];//获取到所有li的小计
             var em=oLi[i].getElementsByTagName("em")[0];//获取到所有li的单价
	     sum1=sum1+Number(strongs.innerHTML);
             sum2=sum2+parseFloat(spans.innerHTML);//合计即所有小计相加的结果，因为有小数所以要用parseFloat
          if(parseFloat(em.innerHTML)>emMax){//最大的那个单价值
              emMax=parseFloat(em.innerHTML);
                    }
                }
		aEm[0].innerHTML=sum1+'件';
                aEm[1].innerHTML=sum2+'元';
                aStrong.innerHTML=emMax+'元';
            }
	  fn2();
	  oBtn[0].onclick = function(){
			n1--;
			if(n1<0){
			   n1 = 0;
			}
			oStrong.innerHTML = n1;
			oSpan.innerHTML = n1*n2+'元';
			fn2();//调用合计之后的值
			};
	 oBtn[1].onclick = function(){
			n1++;
			oStrong.innerHTML = n1;
			oSpan.innerHTML = n1*n2+'元';
			fn2();
			};
	}
}
</script>
{% endblock %}